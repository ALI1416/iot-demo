# 物联网协议测试

## 事件

### Event1002 温度计事件

嵌入式通过MQTT发送到后端
`$iot/event/123/1/1002`

```json
{
  "temperature": 26500
}
```

后端通过WebSocket发送到前端
`/topic/iot/event/123/1/1002`

前端监听WebSocket
`/topic/iot/event/123/1/1002`

## 故障

### Fault2002 温度计故障

嵌入式通过MQTT发送到后端
`$iot/fault/123/1/2002`

```json
[1]
```

后端通过WebSocket发送到前端
`/topic/iot/fault/123/1/2002`

前端监听WebSocket
`/topic/iot/fault/123/1/2002`

## 交互

### Interact3001 设置通信地址

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 0,
  "commandCode": 3001,
  "requestJson": {
    "uri": "mqtt://127.0.0.1:1883",
    "username": "",
    "password": ""
  }
}
```

后端通过MQTT发送到嵌入式
`$iot/request/123/0/3001/123456789012`

```json
{
  "uri": "mqtt://127.0.0.1:1883",
  "username": "",
  "password": ""
}
```

嵌入式通过MQTT发送到后端
`$iot/response/123/0/3001/123456789012/0`

后端通过WebSocket发送到前端
`/topic/iot/interact/123/0/3001`

前端监听WebSocket
`/topic/iot/interact/123/0/3001`

### Interact3002 设置温度计配置

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 1,
  "commandCode": 3002,
  "requestJson": {
    "intervalRefresh": 1,
    "intervalPush": 2,
    "temperatureMax": 30000,
    "temperatureMin": 10000
  }
}
```

后端通过MQTT发送到嵌入式
`$iot/request/123/1/3002/123456789012`

```json
{
  "intervalRefresh": 1,
  "intervalPush": 2,
  "temperatureMax": 30000,
  "temperatureMin": 10000
}
```

嵌入式通过MQTT发送到后端
`$iot/response/123/1/3002/123456789012/0`

后端通过WebSocket发送到前端
`/topic/iot/interact/123/1/3002`

前端监听WebSocket
`/topic/iot/interact/123/1/3002`

### Interact4000 获取网关信息

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 0,
  "commandCode": 4000
}
```


后端通过MQTT发送到嵌入式
`$iot/request/123/0/4000/123456789012`

嵌入式通过MQTT发送到后端
`$iot/response/123/0/4000/123456789012/0`

```json
{
  "deviceList": [
    {
      "sn": 0,
      "type": 0
    },
    {
      "sn": 1,
      "type": 1
    }
  ]
}
```

后端通过WebSocket发送到前端
`/topic/iot/interact/123/0/4000`

前端监听WebSocket
`/topic/iot/interact/123/0/4000`

### Interact4001 获取通信地址

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 0,
  "commandCode": 4001
}
```

后端通过MQTT发送到嵌入式
`$iot/request/123/0/4001/123456789012`

嵌入式通过MQTT发送到后端
`$iot/response/123/0/4001/123456789012/0`

```json
{
  "uri": "mqtt://127.0.0.1:1883",
  "username": "",
  "password": ""
}
```

后端通过WebSocket发送到前端
`/topic/iot/interact/123/0/4001`

前端监听WebSocket
`/topic/iot/interact/123/0/4001`

### Interact4002 获取温度计配置

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 1,
  "commandCode": 4002
}
```

后端通过MQTT发送到嵌入式
`$iot/request/123/1/4002/123456789012`

嵌入式通过MQTT发送到后端
`$iot/response/123/1/4002/123456789012/0`

```json
{
  "intervalRefresh": 1,
  "intervalPush": 2,
  "temperatureMax": 30000,
  "temperatureMin": 10000
}
```

后端通过WebSocket发送到前端
`/topic/iot/interact/123/1/4002`

前端监听WebSocket
`/topic/iot/interact/123/1/4002`
