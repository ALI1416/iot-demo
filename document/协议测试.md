# 物联网协议测试

## 事件

### 心跳

嵌入式通过MQTT发送到后端
`$iot/event/123/0/1000`

后端通过WebSocket发送到前端
`/topic/iot/event/123/0/1000`

前端监听WebSocket
`/topic/iot/event/123/0/1000`

### 网关

嵌入式通过MQTT发送到后端
`$iot/event/123/0/1001`

```json
{
  "deviceList": [
    {
      "sn": 0,
      "type": 0
    },
    {
      "sn": 1,
      "type": 1
    }
  ]
}
```

后端通过WebSocket发送到前端
`/topic/iot/event/123/0/1001`

前端监听WebSocket
`/topic/iot/event/123/0/1001`

### 温湿度

嵌入式通过MQTT发送到后端
`$iot/event/123/1/1002`

```json
{
  "temperature": 2650,
  "humidity": 7550
}
```

后端通过WebSocket发送到前端
`/topic/iot/event/123/1/1002`

前端监听WebSocket
`/topic/iot/event/123/1/1002`

## 故障

### 温湿度

嵌入式通过MQTT发送到后端
`$iot/fault/123/1/2002`

```json
[1]
```

后端通过WebSocket发送到前端
`/topic/iot/fault/123/1/2002`

前端监听WebSocket
`/topic/iot/fault/123/1/2002`

## 交互

### 设置通信地址

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 0,
  "commandCode": 3001,
  "requestJson": {
    "uri": "mqtt://127.0.0.1:1883",
    "username": "",
    "password": ""
  }
}
```

后端通过MQTT发送到嵌入式
`$iot/request/123/0/3001/123456789012`

```json
{
  "uri": "mqtt://127.0.0.1:1883",
  "username": "",
  "password": ""
}
```

嵌入式通过MQTT发送到后端
`$iot/response/123/0/3001/123456789012/0`

后端通过WebSocket发送到前端
`/topic/iot/interact/123/0/3001`

前端监听WebSocket
`/topic/iot/interact/123/0/3001`

### 设置温湿度报警

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 1,
  "commandCode": 3002,
  "requestJson": {
    "temperatureMax": 3000,
    "temperatureMin": 1000,
    "humidityMax": 9000,
    "humidityMin": 5000
  }
}
```

后端通过MQTT发送到嵌入式
`$iot/request/123/1/3002/123456789012`

```json
{
  "temperatureMax": 3000,
  "temperatureMin": 1000,
  "humidityMax": 9000,
  "humidityMin": 5000
}
```

嵌入式通过MQTT发送到后端
`$iot/response/123/1/3002/123456789012/0`

后端通过WebSocket发送到前端
`/topic/iot/interact/123/1/3002`

前端监听WebSocket
`/topic/iot/interact/123/1/3002`

### 获取通信地址

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 0,
  "commandCode": 4001
}
```

后端通过MQTT发送到嵌入式
`$iot/request/123/0/4001/123456789012`

嵌入式通过MQTT发送到后端
`$iot/response/123/0/4001/123456789012/0`

```json
{
  "uri": "mqtt://127.0.0.1:1883",
  "username": "",
  "password": ""
}
```

后端通过WebSocket发送到前端
`/topic/iot/interact/123/0/4001`

前端监听WebSocket
`/topic/iot/interact/123/0/4001`

### 获取温湿度报警

前端通过HTTP发送到后端

```json
{
  "gatewaySn": 123,
  "deviceSn": 1,
  "commandCode": 4002
}
```

后端通过MQTT发送到嵌入式
`$iot/request/123/1/4002/123456789012`

嵌入式通过MQTT发送到后端
`$iot/response/123/1/4002/123456789012/0`

```json
{
  "temperatureMax": 3000,
  "temperatureMin": 1000,
  "humidityMax": 9000,
  "humidityMin": 5000
}
```

后端通过WebSocket发送到前端
`/topic/iot/interact/123/1/4002`

前端监听WebSocket
`/topic/iot/interact/123/1/4002`
